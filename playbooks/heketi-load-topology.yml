---
- hosts: all
  remote_user: root
  gather_facts: no
  connection: local


  vars:
    env:
        HEKETI_CLI_SERVER: "http://{{servername}}"

  tasks:
  - name: Load Heketi topology
    heketi: action=load sshuser="{{ ssh_user }}"  userkey="{{ user_key }}" server="{{ servername }}"
            managehost={{ item.manage }} storagehost={{ item.storage }} zone={{ item.zone }}
            devices="{{ item.devices }}" filename="{{ topologyfile }}" cluster="{{ cluster }}"
    with_items: hdict
    register: result
    environment: "{{ env }}"

  - debug: msg="{{ result.results[0]['msg'] }}"
